/*
 jCanvas v13.01.05
Copyright 2013, Caleb Evans
Licensed under the MIT license
*/
(function(d,Y,da,Q,ea,u,w,f,x){function E(){}function H(c){c?B(fa,c):H.prefs=fa=E.prototype=B({},V);return this}function K(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function C(c){return c&&
c.getContext?c.getContext("2d"):f}function N(c,a,b){b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();b._transformed&&a.restore();b.mask&&(b.autosave&&(a.save(),c=L(c),c.transforms.mask=u,c.savedTransforms=B({},c.transforms)),a.clip())}function ga(c,a,b){a._toRad=a.inDegrees?F/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function ha(c,a,b){1!==
a.scale&&(a.scaleX=a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function ia(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function J(c,a,b,e){a._toRad=a.inDegrees?F/180:1;a._transformed=u;c.save();e===x&&(e=b);!a.fromCenter&&!a._centered&&(a.x+=b/2,a.y+=e/2,a._centered=u);a.rotate&&ga(c,a,{});(1!==a.scale||1!==
a.scaleX||1!==a.scaleY)&&ha(c,a,{});(a.translate||a.translateX||a.translateY)&&ia(c,a,{})}function Z(c){c.draggable&&(c.translateX+=c.x,c.translateY+=c.y)}function L(c){var a;G.canvas===c?a=G.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,mask:w},animating:w,animated:f},a.savedTransforms=B({},a.transforms),d.data(c,"jCanvas",a)),G.canvas=c,G.data=a);return a}function ja(c,a,b){b&&b.visible&&(b.method===d.fn.draw?
b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function I(c,a,b,e){var j,g,z="function"===typeof b,D;b=b||{};a._args=b;if(b.layer&&!b._layer){j=d(c);a=j.getLayers();z&&(b={method:d.fn.draw,fn:b});b=B(new E,b);if(!z){b.method=d.fn[b.method]||e;D=L(c);for(g in H.events)H.events.hasOwnProperty(g)&&b[g]&&(g=$(g),H.events[g](j,D),b._event=u);if(b.draggable||b.cursor){b._event=u;c=["mousedown","mousemove","mouseup"];for(e=0;e<c.length;e+=1)g=$(c[e]),H.events[g](j,D);D.mouseout||(j.bind("mouseout.jCanvas",
function(){D.drag={};j.drawLayers()}),D.mouseout=u)}}b.layer=u;b._layer=u;b.index===x&&(b.index=a.length);a.splice(b.index,0,b)}return b}function ka(c){var a;for(a=0;a<P.length;a+=1)c[P[a]]=c["_"+P[a]]}function la(c,a){var b;for(b=0;b<P.length;b+=1)c["_"+P[b]]=c[P[b]],aa[P[b]]=1,a&&delete c[P[b]]}function ma(c){var a,b,e=[],j=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=Y.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),
c.match(/%/gi)&&(j=2.55),e[0]*=j,e[1]*=j,e[2]*=j,e[3]=e[3]!==x?ea(e[3]):1);return e}function ra(c){var a=3,b;"object"!==typeof c.start&&(c.start=ma(c.start),c.end=ma(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=S(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function $(c){"ontouchstart"in
window&&ba[c]&&(c=ba[c]);return c}function O(c){H.events[c]=function(a,b){c=$(c);var e="mouseover"===c||"mouseout"===c?"mousemove":c,j=b.event;b[e]||(a.bind(e+".jCanvas",function(b){j.x=b.offsetX;j.y=b.offsetY;j.type=e;j.event=b;a.drawLayers(u);b.preventDefault()}),b[e]=u)}}function M(c,a,b){var e,j,g,d;b=b._args;b._event&&(c=L(c),e=c.event,a=a.isPointInPath(e.x,e.y),j=c.transforms,b.eventX=b.mouseX=e.x,b.eventY=b.mouseY=e.y,b.event=e.event,d=c.transforms.rotate,e=b.eventX,g=b.eventY,b._eventX=e*
R(-d)-g*T(-d),b._eventY=g*R(-d)+e*T(-d),b._eventX/=j.scaleX,b._eventY/=j.scaleY,!a&&(b._hovered&&!b._fired)&&(b._mousedout=u),a&&c.intersects.push(b))}function W(c,a,b,e,j){a.save();a.beginPath();a.rect(e[0],j[0],e[1]-e[0],j[1]-j[0]);a.clip();J(a,b,0);a.beginPath()}function X(c,a,b){b._event&&M(c,a,b);a.restore();N(c,a,b)}function na(c,a){a.font?c.font=a.font:(isNaN(Number(a.fontSize))||(a.fontSize+="px"),c.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily)}function oa(c,a,b,e,j){var g=/\b(\d*\.?\d*)\w\w\b/gi,
z;if(G.text===e.text&&G.font===e.font&&G.fontStyle===e.fontStyle&&G.fontSize===e.fontSize&&G.fontFamily===e.fontFamily&&G.maxWidth===e.maxWidth&&G.lineHeight===e.lineHeight)e.width=G.width,e.height=G.height;else if(!a){e.width=b.measureText(j[0]).width;for(a=1;a<j.length;a+=1)z=b.measureText(j[a]).width,z>e.width&&(e.width=z);b=c.style.fontSize;if(e.font){if(a=e.font.match(g))c.style.fontSize=e.font.match(g)[0]}else c.style.fontSize=e.fontSize;e.height=ea(d.css(c,"fontSize"))*j.length*e.lineHeight;
c.style.fontSize=b}}var V,fa,B=d.extend,S=Q.round,F=Q.PI,T=Q.sin,R=Q.cos,sa=d.event.fix,ba,ca,pa,G={},P,aa;d.fn.jCanvas=H;H.events={};V={align:"center",autosave:u,baseline:"middle",bringToFront:w,ccw:w,closed:w,compositing:"source-over",cornerRadius:0,cropFromCenter:u,disableDrag:w,disableEvents:w,domain:f,draggable:w,each:f,end:360,fillStyle:"transparent",font:"",fontStyle:"",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:u,fn:f,graph:"y",height:f,inDegrees:u,lineHeight:1,load:f,mask:w,maxWidth:f,
method:f,miterLimit:10,opacity:1,projection:0,r1:f,r2:f,radius:0,range:f,repeat:"repeat",rotate:0,rounded:w,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:f,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,type:f,visible:u,width:f,x:0,y:0};H();H.extend=function(c){H.defaults=B(V,c.props);H();c.name&&(d.fn[c.name]=function b(e){var j,g,
d,D=B(new E,e);for(g=0;g<this.length;g+=1)if(j=this[g],d=C(j))e=I(j,D,e,b),K(d,D),c.fn.call(j,d,D);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:L(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),e,j;if(c&&c.layer)e=c;else if("number"===b)0>c&&(c=a.length+c),e=a[c];else for(j=0;j<a.length;j+=1)if(a[j].index=j,a[j].name===c||"regexp"===b&&a[j].name.match(c)){e=a[j];break}return e};d.fn.setLayer=function(c,a){var b,e;for(b=
0;b<this.length;b+=1)(e=d(this[b]).getLayer(c))&&B(e,a);return this};d.fn.moveLayer=function(c,a){var b,e,j;for(e=0;e<this.length;e+=1)if(b=d(this[e]),j=b.getLayers(),b=b.getLayer(c))j.splice(b.index,1),j.splice(a,0,b),0>a&&(a=j.length+a),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;for(b=0;b<this.length;b+=1)a=d(this[b]),e=a.getLayers(),(a=a.getLayer(c))&&e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=
0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),e=[],j;if("array"===b)return c;for(j=0;j<a.length;j+=1)a[j].index=j,(a[j].group===c||"regexp"===b&&a[j].group.match(c))&&e.push(a[j]);return e};d.fn.setLayerGroup=function(c,a){var b,e,j;for(e=0;e<this.length;e+=1){b=d(this[e]);b=b.getLayerGroup(c);for(j=0;j<b.length;j+=1)B(b[j],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),j;if(c!==x)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(j=
0;j<a.length;j+=1)if(a[j].index=j,a[j].group===c||"regexp"===e&&a[j].group.match(c))a.splice(j,1),j-=1}return this};d.fn.drawLayer=function(c){var a,b,e,j;for(a=0;a<this.length;a+=1)e=d(this[a]),b=C(this[a]),j=e.getLayer(c),ja(e,b,j);return this};d.fn.drawLayers=function(c){var a,b,e,j,g,z,D,q,v;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=C(this[b])){L(this[b]);a.clearCanvas();G.canvas===this[b]?D=G.data:(D=L(this[b]),G.canvas=this[b],G.data=D);j=D.layers;for(z=0;z<j.length;z+=1)g=j[z],g.index=z,
c&&(g._fired=w),g._event=!g.disableEvents,ja(a,e,g),g._mousedout&&(g._mousedout=w,g._fired=u,g._hovered=w,g.mouseout&&g.mouseout.call(this[b],g),g.cursor&&g._cursor&&a.css({cursor:g._cursor}));g=D.intersects[D.intersects.length-1]||{};e=D.event;z=e.type;g[z]||ca[z]&&(z=ca[z]);v=g[z];q=D.drag;if(g._event){if((g.mouseover||g.mouseout||g.cursor)&&!g._hovered&&!g._fired)g._fired=u,g._hovered=u,g.mouseover&&g.mouseover.call(this[b],g),g.cursor&&(g._cursor=a.css("cursor"),a.css({cursor:g.cursor}));v&&!g._fired&&
(g._fired=u,v.call(this[b],g),e.type=f);if(g.draggable&&!g.disableDrag&&("mousedown"===z||"touchstart"===z))g.bringToFront&&(j.splice(g.index,1),g.index=j.push(g)),q.layer=g,q.dragging=u,q.startX=g.x,q.startY=g.y,q.endX=g._eventX,q.endY=g._eventY,g.dragstart&&g.dragstart.call(this[b],g)}if(q.layer){if(q.dragging&&("mouseup"===z||"touchend"===z))q.layer.dragstop&&q.layer.dragstop.call(this[b],q.layer),D.drag={};if(q.dragging&&("mousemove"===z||"touchmove"===z))q.layer.x=q.layer._eventX-(q.endX-q.startX),
q.layer.y=q.layer._eventY-(q.endY-q.startY),q.layer.drag&&q.layer.drag.call(this[b],q.layer)}D.intersects=[]}return this};d.fn.addLayer=function(c){var a,b;c=c||{};for(a=0;a<this.length;a+=1)if(b=C(this[a]))c.layer=u,c.type&&!c.method&&(c.method=d.fn[pa[c.type]]),c=I(this[a],{},c,c.method);return this};P=["width","height","opacity","lineHeight"];aa={};d.fn.animateLayer=function(){function c(a,b,c){return function(){(!b.animating||b.animated===c)&&a.drawLayers();ka(c);g[4]&&g[4].call(a[0],c);c._animating=
w;b.animating=w;b.animated=f}}function a(a,b,c){return function(e,j){!c._animating&&!b.animating&&(c._animating=u,b.animating=u,b.animated=c);(!b.animating||b.animated===c)&&a.drawLayers();ka(c);g[5]&&g[5].call(a[0],e,j,c)}}var b,e,j,g=[].slice.call(arguments,0),z;"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,0,g[2].duration||f),g.splice(3,0,g[3].easing||f),g.splice(4,0,g[4].complete||f),g.splice(5,0,g[5].step||f)):(g[2]===x?(g.splice(2,0,f),g.splice(3,0,f),
g.splice(4,0,f)):"function"===typeof g[2]&&(g.splice(2,0,f),g.splice(3,0,f)),g[3]===x?(g[3]=f,g.splice(4,0,f)):"function"===typeof g[3]&&g.splice(3,0,f));g[1]=B({},g[1]);for(e=0;e<this.length;e+=1)if(b=d(this[e]),j=C(this[e]))if(j=L(this[e]),(z=b.getLayer(g[0]))&&z.method!==d.fn.draw)la(z),la(g[1],u),z.style=aa,d(z).animate(g[1],{duration:g[2],easing:d.easing[g[3]]?g[3]:f,complete:c(b,j,z),step:a(b,j,z)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),j,g;for(b=
0;b<this.length;b+=1){a=d(this[b]);j=a.getLayerGroup(c);for(g=0;g<j.length;g+=1)a.animateLayer.apply(a,[j[g]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e;a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,e,j,g;a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);j=b.getLayerGroup(c);for(g=0;g<j.length;g+=1)b.delayLayer.call(b,j[g],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),
d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,j,g;for(e=0;e<this.length;e+=1){b=d(this[e]);j=b.getLayerGroup(c);for(g=0;g<j.length;g+=1)b.stopLayer.call(b,j[g],a)}};var qa="color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "),U;for(U=0;U<qa.length;U+=1)d.fx.step[qa[U]]=ra;ba={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};ca={touchstart:"mousedown",touchend:"mouseup",
touchmove:"mousemove"};O("click");O("dblclick");O("mousedown");O("mouseup");O("mousemove");O("mouseover");O("mouseout");O("touchstart");O("touchmove");O("touchend");d.event.fix=function(c){var a,b;c=sa.call(d.event,c);if(a=c.originalEvent)if(b=a.changedTouches,c.pageX!==x&&c.offsetX===x){if(a=d(c.target).offset())c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top}else if(b&&(a=d(a.target).offset()))c.offsetX=b[0].pageX-a.left,c.offsetY=b[0].pageY-a.top;return c};pa={arc:"drawArc",bezier:"drawBezier",
circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function a(b){var e,j;b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((j=C(this[e]))&&b.fn)b=I(this[e],{},b,a),b.fn.call(this[e],j);return this};d.fn.clearCanvas=function(a){var b,e=B(new E,a);for(a=0;a<this.length;a+=1)if(b=C(this[a]))J(b,e,e.width,e.height),b.setTransform(1,
0,0,1,0,0),!e.x||!e.y||!e.width||!e.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),b.restore();return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=C(this[a]))e=L(this[a]),b.save(),e.savedTransforms=B({},e.transforms);return this};d.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=C(this[a]))e=L(this[a]),b.restore(),e.transforms=B({},e.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=
function(a){var b={layer:u,fn:function(){d(this).restoreCanvas()}};B(b,a);return this.draw(b)};d.fn.translateCanvas=function(a){var b,e=B(new E,a),j;for(a=0;a<this.length;a+=1)if(b=C(this[a]))j=L(this[a]),e.autosave&&b.save(),ia(b,e,j.transforms);return this};d.fn.scaleCanvas=function(a){var b,e=B(new E,a),j;for(a=0;a<this.length;a+=1)if(b=C(this[a]))j=L(this[a]),e.autosave&&b.save(),ha(b,e,j.transforms);return this};d.fn.rotateCanvas=function(a){var b,e=B(new E,a),j;for(a=0;a<this.length;a+=1)if(b=
C(this[a]))j=L(this[a]),e.autosave&&b.save(),ga(b,e,j.transforms);return this};d.fn.drawRect=function b(e){var j,g,d=B(new E,e),f,q,v,y,t;for(j=0;j<this.length;j+=1)if(g=C(this[j]))e=I(this[j],d,e,b),K(g,d),J(g,d,d.width,d.height),g.beginPath(),f=d.x-d.width/2,q=d.y-d.height/2,(t=d.cornerRadius)?(d.closed=u,v=d.x+d.width/2,y=d.y+d.height/2,0>v-f-2*t&&(t=(v-f)/2),0>y-q-2*t&&(t=(y-q)/2),g.moveTo(f+t,q),g.lineTo(v-t,q),g.arc(v-t,q+t,t,3*F/2,2*F,w),g.lineTo(v,y-t),g.arc(v-t,y-t,t,0,F/2,w),g.lineTo(f+
t,y),g.arc(f+t,y-t,t,F/2,F,w),g.lineTo(f,q+t),g.arc(f+t,q+t,t,F,3*F/2,w)):g.rect(f,q,d.width,d.height),d._event&&M(this[j],g,d),N(this[j],g,d);return this};d.fn.drawArc=function e(j){var g,d,f=B(new E,j);j=j||{};!f.inDegrees&&360===f.end&&(j.end=f.end=2*F);for(g=0;g<this.length;g+=1)if(d=C(this[g]))j=I(this[g],f,j,e),K(d,f),J(d,f,2*f.radius),d.beginPath(),d.arc(f.x,f.y,f.radius,f.start*f._toRad-F/2,f.end*f._toRad-F/2,f.ccw),f._event&&M(this[g],d,f),N(this[g],d,f);return this};d.fn.drawEllipse=function j(g){var d,
f,q=B(new E,g),v=4*q.width/3,y=q.height;q.closed=u;for(d=0;d<this.length;d+=1)if(f=C(this[d]))g=I(this[d],q,g,j),K(f,q),J(f,q,q.width,q.height),f.beginPath(),f.moveTo(q.x,q.y-y/2),f.bezierCurveTo(q.x-v/2,q.y-y/2,q.x-v/2,q.y+y/2,q.x,q.y+y/2),f.bezierCurveTo(q.x+v/2,q.y+y/2,q.x+v/2,q.y-y/2,q.x,q.y-y/2),q._event&&M(this[d],f,q),N(this[d],f,q);return this};d.fn.drawPolygon=function g(d){var f,q,v=B(new E,d),y=2*F/v.sides,t=F/v.sides,r=t+F/2,n=v.radius*R(y/2),k,l,p;d.closed=v.closed=u;for(f=0;f<this.length;f+=
1)if(q=C(this[f])){d=I(this[f],v,d,g);K(q,v);J(q,v,2*v.radius);q.beginPath();for(p=0;p<v.sides;p+=1)k=v.x+S(v.radius*R(r)),l=v.y+S(v.radius*T(r)),q.lineTo(k,l),v.projection&&(k=v.x+S((n+n*v.projection)*R(r+t)),l=v.y+S((n+n*v.projection)*T(r+t)),q.lineTo(k,l)),r+=y;v._event&&M(this[f],q,v);N(this[f],q,v)}return this};d.fn.drawLine=function z(d){var f,v,y=B(new E,d),t,r,n;for(f=0;f<this.length;f+=1)if(v=C(this[f])){d=I(this[f],y,d,z);K(v,y);Z(y);J(v,y,0);t=1;for(v.beginPath();u;)if(r=y["x"+t],n=y["y"+
t],r!==x&&n!==x)v.lineTo(r,n),t+=1;else break;y._event&&M(this[f],v,y);N(this[f],v,y)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function D(d){var f,y,t=B(new E,d),r,n,k,l,p;for(f=0;f<this.length;f+=1)if(y=C(this[f])){d=I(this[f],t,d,D);K(y,t);Z(t);J(y,t,0);r=2;y.beginPath();for(y.moveTo(t.x1,t.y1);u;)if(n=t["x"+r],k=t["y"+r],l=t["cx"+(r-1)],p=t["cy"+(r-1)],n!==x&&k!==x&&l!==x&&p!==x)y.quadraticCurveTo(l,p,n,k),r+=1;else break;t._event&&M(this[f],y,t);N(this[f],y,t)}return this};d.fn.drawBezier=
function q(d){var f,t,r=B(new E,d),n,k,l,p,s,m,h,A;for(f=0;f<this.length;f+=1)if(t=C(this[f])){d=I(this[f],r,d,q);K(t,r);Z(r);J(t,r,0);n=2;k=1;t.beginPath();for(t.moveTo(r.x1,r.y1);u;)if(l=r["x"+n],p=r["y"+n],s=r["cx"+k],m=r["cy"+k],h=r["cx"+(k+1)],A=r["cy"+(k+1)],l!==x&&p!==x&&s!==x&&m!==x&&h!==x&&A!==x)t.bezierCurveTo(s,m,h,A,l,p),n+=1,k+=2;else break;r._event&&M(this[f],t,r);N(this[f],t,r)}return this};d.fn.drawVector=function v(d){var f,r,n=B(new E,d),k,l,p,s,m;for(f=0;f<this.length;f+=1)if(r=
C(this[f])){d=I(this[f],n,d,v);K(r,n);J(r,n,0);k=1;r.beginPath();s=n.x;m=n.y;for(r.moveTo(n.x,n.y);u;)if(l=n["a"+k],p=n["l"+k],l!==x&&p!==x)l=l*n._toRad-F/2,s+=p*Q.cos(l),m+=p*Q.sin(l),r.lineTo(s,m),k+=1;else break;n._event&&M(this[f],r,n);N(this[f],r,n)}return this};d.fn.drawGraph=function y(d){var r,n,k=B(new E,d),l,p,s,m,h;for(r=0;r<this.length;r+=1)if((n=C(this[r]))&&k.fn){d=I(this[r],k,d,y);K(n,k);l=k.graph;p=k.domain;s=k.range;m=this[r].width;h=this[r].height;p===f&&(p=[f,f]);p[0]===f&&(p[0]=
0);p[1]===f&&(p[1]=m);s===f&&(s=[f,f]);s[0]===f&&(s[0]=0);s[1]===f&&(s[1]=h);W(r,n,k,p,s);if("y"===l)for(l=p[0]-k.x;l<=p[1]-k.x;l+=1)h=k.fn(l),h===f?(X(this[r],n,k),W(r,n,k,p,s)):n.lineTo(l+k.x,h+k.y);else if("x"===l)for(h=s[0]-k.y;h<=s[1]-k.y;h+=1)l=k.fn(h),l===f?(X(this[r],n,k),W(r,n,k,p,s)):n.lineTo(l+k.x,h+k.y);else if("r"===l)for(m=0;m<2*F;m+=F/180)h=k.fn(m),l=h*R(m),h*=T(m),l===f||h===f?(X(this[r],n,k),W(n,k,p,s)):n.lineTo(l+k.x,h+k.y);X(this[r],n,k)}};d.fn.drawText=function t(r){var n,k,l=
B(new E,r),p,s,m,h;for(n=0;n<this.length;n+=1)if(d(this[n]),k=C(this[n])){r=I(this[n],l,r,t);K(k,l);k.textBaseline=l.baseline;k.textAlign=l.align;na(k,l);if(!n&&l.maxWidth!==f){p=k;s=l.text;h=l.maxWidth;var A=s.split(" "),u=void 0,x=[],w="";if(p.measureText(s).width<h||1===A.length)x=[s];else{for(u=0;u<A.length;u+=1)p.measureText(w+A[u]).width>h&&(""!==w&&x.push(w),w=""),w+=A[u],u!==A.length-1&&(w+=" ");x.push(w)}p=x;p=p.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else n||(p=String(l.text).split("\n"));
oa(this[n],n,k,l,p);J(k,l,l.width,l.height);n||(m=l.x,"left"===l.align?m-=l.width/2:"right"===l.align&&(m+=l.width/2));for(s=0;s<p.length;s+=1)k.shadowColor=l.shadowColor,h=l.y+s*l.height/p.length-(p.length-1)*l.height/p.length/2,k.fillText(p[s],m,h),"transparent"!==l.fillStyle&&(k.shadowColor="transparent"),k.strokeText(p[s],m,h);l._event?(k.beginPath(),k.rect(l.x-l.width/2,l.y-l.height/2,l.width,l.height),k.restore(),M(this[n],k,l),k.closePath()):k.restore()}G=l;return this};d.fn.measureText=function(d){var f;
f=d!==x&&("object"!==typeof d||d.layer)?this.getLayer(d):B(new E,d);if((d=C(this[0]))&&f.text!==x)na(d,f),oa(this[0],0,d,f,f.text.split("\n"));return f};d.fn.drawImage=function r(d){function k(r,k,m){return function(){k||(x=A.width/A.height,h.width===f&&h.sWidth===f&&(d.width=h.width=h.sWidth=A.width),h.height===f&&h.sHeight===f&&(d.height=h.height=h.sHeight=A.height),h.width===f&&h.sWidth!==f&&(h.width=h.sWidth),h.height===f&&h.sHeight!==f&&(h.height=h.sHeight),h.sWidth===f&&h.width!==f&&(d.sWidth=
h.sWidth=A.width),h.sHeight===f&&h.height!==f&&(d.sHeight=h.sHeight=A.height),h.sx===f&&(h.sx=h.cropFromCenter?A.width/2:0),h.sy===f&&(h.sy=h.cropFromCenter?A.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>A.width&&(h.sx=A.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>A.height&&(h.sy=A.height-h.sHeight/2),h.width!==f&&h.height===f?d.height=h.height=h.width/x:h.width===f&&h.height!==f?d.width=h.width=
h.height*x:h.width===f&&h.height===f&&(d.width=h.width=A.width,d.height=h.height=A.height));J(m,h,h.width,h.height);m.drawImage(A,h.sx-h.sWidth/2,h.sy-h.sHeight/2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);m.fillStyle="transparent";m.beginPath();m.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event&&M(l[k],m,h);N(l[k],m,h);h.load&&h.load.call(r,d)}}var l=this,p,s,m,h=B(new E,d),A,u,x;u=h.source.getContext;h.source.src||u?A=h.source:h.source&&(A=new da,A.src=h.source);
for(s=0;s<l.length;s+=1)if(p=l[s],m=C(l[s]))d=I(l[s],h,d,r),K(m,h),A&&(A.complete||u?k(p,s,m)():(A.onload=k(p,s,m),A.src=A.src));return l};d.fn.createPattern=d.fn.pattern=function(d){function n(){m=l.createPattern(s,p.repeat);p.load&&p.load.call(k[0],m)}var k=this,l,p=B(new E,d),s,m;(l=C(k[0]))?"function"===typeof p.source?(s=Y.createElement("canvas"),s.width=p.width,s.height=p.height,d=C(s),p.source.call(s,d),n()):(d=p.source.getContext,p.source.src||d?s=p.source:(s=new da,s.src=p.source),s.complete||
d?n():s.onload=n):m=f;return m};d.fn.createGradient=d.fn.gradient=function(d){var n;d=B(new E,d);var k=[],l,p,s,m,h,u,w;if(n=C(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;n=d.r1!==f||d.r2!==f?n.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):n.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(m=1;d["c"+m]!==x;m+=1)d["s"+m]!==x?k.push(d["s"+m]):k.push(f);l=k.length;k[0]===f&&(k[0]=0);k[l-1]===f&&(k[l-1]=1);for(m=0;m<l;m+=1){if(k[m]!==f){u=1;w=0;p=k[m];for(h=m+1;h<l;h+=1)if(k[h]!==
f){s=k[h];break}else u+=1;p>s&&(k[h]=k[m])}else k[m]===f&&(w+=1,k[m]=p+w*((s-p)/u));n.addColorStop(k[m],d["c"+(m+1)])}}else n=f;return n};d.fn.setPixels=function n(d){var f,p,s,m=B(new E,d),h={},u,x,w,F;for(p=0;p<this.length;p+=1)if(f=this[p],s=C(f)){d=I(this[p],m,d,n);J(s,m,m.width,m.height);if(!m.x||!m.y||!m.width||!m.height)m.width=f.width,m.height=f.height,m.x=m.width/2,m.y=m.height/2;u=s.getImageData(m.x-m.width/2,m.y-m.height/2,m.width,m.height);x=u.data;F=x.length;h=[];if(m.each)for(w=0;w<
F;w+=4)h.r=x[w],h.g=x[w+1],h.b=x[w+2],h.a=x[w+3],m.each.call(f,h),x[w]=h.r,x[w+1]=h.g,x[w+2]=h.b,x[w+3]=h.a;s.putImageData(u,m.x-m.width/2,m.y-m.height/2);s.restore()}return this};d.fn.getCanvasImage=function(d,k){var l=this[0];return l&&l.toDataURL?l.toDataURL("image/"+d,k):f};d.support.canvas=Y.createElement("canvas").getContext!==x;H.defaults=V;H.detectEvents=M;H.closePath=N;d.jCanvas=H})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
